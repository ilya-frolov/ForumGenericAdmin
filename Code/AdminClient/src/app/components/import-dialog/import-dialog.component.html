<!-- Toast messages -->
<p-toast></p-toast>

<!-- Loading Indicator -->
<div *ngIf="loading" class="import-loading">
  <div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">Loading...</span>
  </div>
  <p class="mt-2">Processing import...</p>
</div>

<!-- Import File Selection Dialog -->
<p-dialog 
  [(visible)]="importDialogVisible"
  [style]="{width: '450px'}"
  header="Import Data"
  [modal]="true"
  [draggable]="false"
  [resizable]="false">
  <div class="p-fluid">
    <div class="p-field mb-3">
      <label for="importFile">Select Excel or CSV File</label>
      <input 
        type="file" 
        id="importFile"
        class="p-inputtext w-100 mt-2"
        accept=".xlsx,.xls,.csv"
        (change)="onFileSelected($event)">
    </div>
    <small *ngIf="importError" class="p-error">{{importError}}</small>
    <div class="mt-3">
      <p class="text-secondary text-sm">
        Don't have a template? 
        <a href="javascript:void(0)" (click)="downloadImportTemplate()">Download template</a>
      </p>
    </div>
  </div>
  <ng-template pTemplate="footer">
    <button 
      pButton 
      label="Cancel" 
      icon="pi pi-times" 
      class="p-button-text" 
      (click)="cancelImport()"></button>
    <button 
      pButton 
      label="Import" 
      icon="pi pi-check" 
      [disabled]="!selectedFile" 
      (click)="uploadImportFile()"></button>
  </ng-template>
</p-dialog>

<!-- Import Errors Dialog -->
<p-dialog header="Import Errors" [(visible)]="importErrorsDialogVisible" [modal]="true">
  <div *ngIf="importResult && importResult.errors && importResult.errors.length > 0">
    <p>
      <strong>Import Summary:</strong> 
      Total Records: {{importResult.totalRecords}} | 
      Successful: {{importResult.successCount}} | 
      Errors: {{importResult.errorCount}}
    </p>
    <p-table [value]="importResult.errors" styleClass="p-datatable-sm" [paginator]="importResult.errors.length > 10" [rows]="10" 
             [rowsPerPageOptions]="[10, 25, 50]" responsiveLayout="scroll">
      <ng-template pTemplate="header">
        <tr>
          <th>Row</th>
          <th>Field</th>
          <th>Error</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-error>
        <tr>
          <td>{{error.rowNumber}}</td>
          <td>{{error.fieldName}}</td>
          <td>{{error.errorMessage}}</td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="3" class="text-center">No errors found.</td>
        </tr>
      </ng-template>
    </p-table>
  </div>
  <ng-template pTemplate="footer">
    <button pButton icon="pi pi-times" label="Close" (click)="importErrorsDialogVisible = false" 
            class="p-button-text"></button>
  </ng-template>
</p-dialog> 