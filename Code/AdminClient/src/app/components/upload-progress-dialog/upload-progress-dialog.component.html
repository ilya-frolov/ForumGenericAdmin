<p-dialog 
  [(visible)]="visible" 
  [style]="{width: '500px'}"
  [modal]="true"
  [closable]="false"
  [draggable]="false"
  [resizable]="false"
  header="File Upload Progress">
  
  <!-- Progress content -->
  <div *ngIf="!showCompletionScreen" @fadeInOut>
    <!-- Overall progress -->
    <div class="mb-4">
      <h5 class="d-flex justify-content-between align-items-center mb-2">
        <span>Overall Progress</span>
        <span class="badge bg-primary">{{ overallProgress }}%</span>
      </h5>
      <p-progressBar 
        [value]="overallProgress" 
        [showValue]="false"
        [style]="{'height': '1.5rem'}"
        [styleClass]="allComplete ? 'upload-complete' : ''">
      </p-progressBar>
      
      <div class="text-center mt-2" *ngIf="allComplete">
        <span class="badge" [ngClass]="hasErrors ? 'bg-warning' : 'bg-success'">
          <i class="pi" [ngClass]="hasErrors ? 'pi-exclamation-triangle' : 'pi-check-circle'"></i>
          {{ hasErrors ? 'Completed with errors' : 'Upload Complete' }}
        </span>
      </div>
    </div>
    
    <!-- Status summary -->
    <div class="upload-summary mb-3" *ngIf="uploadProgress.length > 0">
      <div class="d-flex justify-content-between">
        <div>
          <span class="fw-bold">Files:</span> {{ uploadProgress.length }}
        </div>
        <div>
          <span class="fw-bold">Completed:</span> {{ completedCount }}/{{ uploadProgress.length }}
        </div>
      </div>
    </div>
    
    <!-- Individual file progress -->
    <div class="file-progress">
      <div class="file-item mb-3" *ngFor="let file of uploadProgress">
        <div class="d-flex justify-content-between align-items-center mb-1">
          <span class="file-name text-truncate" [title]="file.fileName">
            <i class="pi pi-file me-2"></i>
            {{ file.fileName }}
          </span>
          <span class="file-status">
            <span class="badge" [ngClass]="'bg-' + getSeverity(file.status)">
              {{ file.status === 'uploading' ? file.progress + '%' : file.status }}
            </span>
          </span>
        </div>
        <p-progressBar 
          [value]="file.progress" 
          [showValue]="false"
          [styleClass]="'status-' + file.status">
        </p-progressBar>
        <small class="text-danger" *ngIf="file.message">{{ file.message }}</small>
      </div>
    </div>
  </div>
  
  <!-- Completion Screen -->
  <div *ngIf="showCompletionScreen" class="completion-screen text-center py-4" @fadeInOut>
    <!-- Success SVG -->
    <div *ngIf="completionState === 'success'" class="success-svg mb-3" @svgAnimation>
      <svg width="120" height="120" viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="60" cy="60" r="55" stroke="#28a745" stroke-width="10"/>
        <path d="M35 60L50 75L85 40" stroke="#28a745" stroke-width="10" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </div>
    
    <!-- Error SVG -->
    <div *ngIf="completionState === 'error'" class="error-svg mb-3" @svgAnimation>
      <svg width="120" height="120" viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="60" cy="60" r="55" stroke="#dc3545" stroke-width="10"/>
        <path d="M40 40L80 80" stroke="#dc3545" stroke-width="10" stroke-linecap="round"/>
        <path d="M80 40L40 80" stroke="#dc3545" stroke-width="10" stroke-linecap="round"/>
      </svg>
    </div>
    
    <!-- Message -->
    <h3 [ngClass]="completionState === 'success' ? 'text-success' : 'text-danger'">
      {{ completionMessage }}
    </h3>
    
    <!-- Files summary -->
    <div class="files-summary mt-3 mb-4">
      <div class="d-flex justify-content-center">
        <div class="px-3">
          <span class="fw-bold">Files:</span> {{ uploadProgress.length }}
        </div>
        <div class="px-3">
          <span class="fw-bold">Successful:</span> {{ completedCount }}
        </div>
        <div class="px-3" *ngIf="hasErrors">
          <span class="fw-bold">Failed:</span> {{ uploadProgress.length - completedCount }}
        </div>
      </div>
    </div>
    
    <!-- Auto-close timer -->
    <div class="auto-close-timer mb-3">
      <small class="text-muted">
        This dialog will close in {{ timeRemaining }} seconds
      </small>
    </div>
  </div>
  
  <ng-template pTemplate="footer">
    <div class="text-end">
      <button 
        pButton 
        label="Close" 
        icon="pi pi-times" 
        [disabled]="!allComplete && !showCompletionScreen" 
        (click)="close()">
      </button>
    </div>
  </ng-template>
</p-dialog> 